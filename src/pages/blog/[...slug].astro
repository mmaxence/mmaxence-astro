---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Header from '../../components/layout/Header.astro';
import Footer from '../../components/layout/Footer.astro';
import PageContent from '../../components/ui/PageContent.astro';
import AnimatedContent from '../../components/ui/AnimatedContent.astro';
import ThemeToast from '../../components/ui/ThemeToast.astro';
import { getCollection } from 'astro:content';
import type { CollectionEntry } from 'astro:content';

export async function getStaticPaths() {
  const blogPosts = await getCollection('blog');
  return blogPosts
    .filter((post) => !post.data.draft)
    .map((post) => ({
      params: { slug: post.slug },
      props: { post },
    }));
}

interface Props {
  post: CollectionEntry<'blog'>;
}

const { post } = Astro.props;
const { Content } = await post.render();
---

<BaseLayout 
  title={post.data.title} 
  description={post.data.description || post.data.title}
  featured_image={post.data.featured_image}
  url={new URL(`/blog/${post.slug}`, Astro.site).href}
>
  <Header />
  <PageContent class="flex flex-col items-center pb-4 min-h-screen">
    <article class="max-w-3xl mx-auto px-3 md:px-6 py-12">
      {post.data.featured_image && (() => {
        const featuredImage = post.data.featured_image.startsWith('/') 
          ? post.data.featured_image 
          : `/blog/${post.slug}/${post.data.featured_image}`;
        return (
          <div class="mb-8">
            <img 
              src={featuredImage} 
              alt={post.data.title}
              class="w-full h-auto rounded-lg"
            />
          {post.data.credential && (
            <p class="text-sm text-gray-500 mt-2">
              {post.data.credentiallink ? (
                <a 
                  href={post.data.credentiallink} 
                  target="_blank" 
                  rel="noopener noreferrer"
                  class="credential"
                  style="color: var(--theme-text-muted);"
                >
                  {post.data.credential}
                </a>
              ) : (
                <span class="credential">{post.data.credential}</span>
              )}
            </p>
          )}
          </div>
        );
      })()}
      
      <header class="mb-8">
        <h1 class="text-4xl md:text-5xl font-mono font-light mb-4">
          {post.data.title}
        </h1>
            <time class="text-sm" style="color: var(--theme-text-muted);">
          {post.data.date.toLocaleDateString('en-US', { 
            year: 'numeric', 
            month: 'long', 
            day: 'numeric' 
          })}
        </time>
      </header>
      
          <div class="prose prose-lg max-w-none leading-relaxed" style="color: var(--theme-text); opacity: 0.9;">
        <Content />
      </div>
        </article>
  </PageContent>
  <Footer />
  <ThemeToast />
</BaseLayout>

